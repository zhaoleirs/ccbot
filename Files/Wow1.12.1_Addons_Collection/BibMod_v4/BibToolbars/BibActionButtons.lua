NUM_BIB_ACTION_BUTTONS = 120;

BINDING_HEADER_BIBACTIONBAR2 = "Action Bar #2 Buttons";
BINDING_NAME_BIBACTIONBUTTON13 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON14 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON15 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON16 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON17 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON18 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON19 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON20 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON21 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON22 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON23 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON24 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR3 = "Action Bar #3 Buttons";
BINDING_NAME_BIBACTIONBUTTON25 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON26 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON27 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON28 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON29 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON30 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON31 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON32 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON33 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON34 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON35 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON36 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR4 = "Action Bar #4 Buttons";
BINDING_NAME_BIBACTIONBUTTON37 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON38 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON39 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON40 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON41 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON42 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON43 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON44 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON45 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON46 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON47 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON48 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR5 = "Action Bar #5 Buttons";
BINDING_NAME_BIBACTIONBUTTON49 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON50 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON51 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON52 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON53 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON54 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON55 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON56 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON57 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON58 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON59 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON60 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR6 = "Action Bar #6 Buttons";
BINDING_NAME_BIBACTIONBUTTON61 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON62 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON63 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON64 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON65 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON66 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON67 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON68 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON69 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON70 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON71 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON72 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR7 = "Action Bar #7 Buttons";
BINDING_NAME_BIBACTIONBUTTON73 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON74 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON75 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON76 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON77 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON78 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON79 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON80 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON81 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON82 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON83 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON84 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR8 = "Action Bar #8 Buttons";
BINDING_NAME_BIBACTIONBUTTON85 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON86 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON87 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON88 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON89 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON90 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON91 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON92 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON93 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON94 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON95 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON96 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR9 = "Action Bar #9 Buttons";
BINDING_NAME_BIBACTIONBUTTON97 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON98 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON99 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON100 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON101 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON102 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON103 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON104 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON105 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON106 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON107 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON108 = "Action Button 12";

BINDING_HEADER_BIBACTIONBAR10 = "Action Bar #10 Buttons";
BINDING_NAME_BIBACTIONBUTTON109 = "Action Button 1";
BINDING_NAME_BIBACTIONBUTTON110 = "Action Button 2";
BINDING_NAME_BIBACTIONBUTTON111 = "Action Button 3";
BINDING_NAME_BIBACTIONBUTTON112 = "Action Button 4";
BINDING_NAME_BIBACTIONBUTTON113 = "Action Button 5";
BINDING_NAME_BIBACTIONBUTTON114 = "Action Button 6";
BINDING_NAME_BIBACTIONBUTTON115 = "Action Button 7";
BINDING_NAME_BIBACTIONBUTTON116 = "Action Button 8";
BINDING_NAME_BIBACTIONBUTTON117 = "Action Button 9";
BINDING_NAME_BIBACTIONBUTTON118 = "Action Button 10";
BINDING_NAME_BIBACTIONBUTTON119 = "Action Button 11";
BINDING_NAME_BIBACTIONBUTTON120 = "Action Button 12";


--This overrides the normal ActionButton_GetPagedID to simply return the button's actual ID for BibActionButtons
function ActionButton_GetPagedID(button)
	return button:GetID();
end

--Overriding ActionButtonDown() and ActionButtonUp() too, but may change this later
function ActionButtonDown(id)
	PressBibActionButton(id);
end

function ActionButtonUp(id, onSelf)
	ReleaseBibActionButton(id, onSelf);
end

function BibActionButtons_ShowGrid()
	local button;
	for i=1, NUM_BIB_ACTION_BUTTONS do
		button = getglobal("BibActionButton"..i);
		button.showgrid = 1;
		getglobal(button:GetName().."NormalTexture"):SetVertexColor(1.0, 1.0, 1.0, 0.5);
		button:Show();
	end
end

function BibActionButtons_HideGrid()
	local button;
	for i=1, NUM_BIB_ACTION_BUTTONS do	
		button = getglobal("BibActionButton"..i);
		if (button.showgrid > 0) then
			button.showgrid = 0;
		end
		if ( button.showgrid == 0 and button:IsVisible() and not HasAction(ActionButton_GetPagedID(button)) ) then
			button:Hide();
		end
	end
end

function GetBibActionButtonName(button_num)
	return "BibActionButton"..button_num;	
end

function PressBibActionButton(button_num)
	local button = getglobal(GetBibActionButtonName(button_num));
	if (button) then
		button:SetButtonState("PUSHED");
	end
end

function ReleaseBibActionButton(button_num, onSelf)
	local button = getglobal(GetBibActionButtonName(button_num));
	if (button) then
		button:SetButtonState("NORMAL");
	end
	UseAction(button:GetID(), 0, onSelf);
end

function BibUpdateActionButtonMapText()
	local maptext = getglobal(this:GetName().."HotKey");
	local action = this.bindingName;
	local mapstr = GetBindingText(GetBindingKey(action), "KEY_");
	mapstr = gsub(mapstr, "ALT", "A");
	mapstr = gsub(mapstr, "CTRL", "C");
	mapstr = gsub(mapstr, "SHIFT", "S");
	mapstr = gsub(mapstr, "Num Pad ", "NP");
	maptext:SetText(mapstr);
end

function BibActionButton_OnUpdate(elapsed)
	if ( ActionButton_IsFlashing() ) then
		this.flashtime = this.flashtime - elapsed;
		if ( this.flashtime <= 0 ) then
			local overtime = -this.flashtime;
			if ( overtime >= ATTACK_BUTTON_FLASH_TIME ) then
				overtime = 0;
			end
			this.flashtime = ATTACK_BUTTON_FLASH_TIME - overtime;

			local flashTexture = getglobal(this:GetName().."Flash");
			if ( flashTexture:IsVisible() ) then
				flashTexture:Hide();
			else
				flashTexture:Show();
			end
		end
	end
	
	-- Handle range indicator
	if ( this.rangeTimer ) then
		if ( this.rangeTimer < 0 ) then
			local cover = getglobal(this:GetName().."Cover");
			if ( IsActionInRange( ActionButton_GetPagedID(this)) == 0 ) then
				cover:SetVertexColor(1.0, 0.0, 0.0, 0.6);
			else
				cover:SetVertexColor(0.0, 0.0, 0.0, 0.0);
			end
			this.rangeTimer = TOOLTIP_UPDATE_TIME;
		else
			this.rangeTimer = this.rangeTimer - elapsed;
		end
	end

	if ( not this.updateTooltip ) then
		return;
	end

	this.updateTooltip = this.updateTooltip - elapsed;
	if ( this.updateTooltip > 0 ) then
		return;
	end

	if ( GameTooltip:IsOwned(this) ) then
		ActionButton_SetTooltip();
	else
		this.updateTooltip = nil;
	end
end

function BibActionButton_UpdateCover()
	-- Handle range indicator
	if ( this.rangeTimer == TOOLTIP_UPDATE_TIME ) then
		local cover = getglobal(this:GetName().."Cover");
		if ( IsActionInRange( ActionButton_GetPagedID(this)) == 0 ) then
			cover:SetVertexColor(1.0, 0.0, 0.0, 0.6);
		else
			cover:SetVertexColor(0.0, 0.0, 0.0, 0.0);
		end
	end
end

function BibSetButtonID(button, id)
	button:SetID(id);
	ActionButton_Update();
end

function UpdateBibButtonID(button)
	if (CURRENT_ACTIONBAR_PAGE == 2 and button.page2ID ~= nil) then
		button.currentID = button.page2ID;
	elseif (CURRENT_ACTIONBAR_PAGE == 3 and button.page3ID ~= nil) then
		button.currentID = button.page3ID;
	elseif (CURRENT_ACTIONBAR_PAGE == 4 and button.page4ID ~= nil) then
		button.currentID = button.page4ID;
	elseif (CURRENT_ACTIONBAR_PAGE == 5 and button.page5ID ~= nil) then
		button.currentID = button.page5ID;
	elseif (CURRENT_ACTIONBAR_PAGE == 6 and button.page6ID ~= nil) then
		button.currentID = button.page6ID;
	elseif (GetComboPoints() == 5 and button.combopoint5ID ~= nil) then
		button.currentID = button.combopoint5ID;
	elseif (GetComboPoints() >= 4 and button.combopoint4ID ~= nil) then
		button.currentID = button.combopoint4ID;
	elseif (GetComboPoints() >= 3 and button.combopoint3ID ~= nil) then
		button.currentID = button.combopoint3ID;
	elseif (GetComboPoints() >= 2 and button.combopoint2ID ~= nil) then
		button.currentID = button.combopoint2ID;
	elseif (GetComboPoints() >= 1 and button.combopoint1ID ~= nil) then
		button.currentID = button.combopoint1ID;
	elseif (this.incombat and button.combatID ~= nil) then
		button.currentID = button.combatID;
	elseif (GetBonusBarOffset() == 1 and button.shapeshift1ID ~= nil) then
		button.currentID = button.shapeshift1ID;
	elseif (GetBonusBarOffset() == 2 and button.shapeshift2ID ~= nil) then
		button.currentID = button.shapeshift2ID;
	elseif (GetBonusBarOffset() == 3 and button.shapeshift3ID ~= nil) then
		button.currentID = button.shapeshift3ID;
	else
		button.currentID = button.normalID;
	end
	
	button.shouldDisplayBackupID = ShouldDisplayBackupID(button);
	if(button.shouldDisplayBackupID) then
		BibSetButtonID(button, button.backupID);
	elseif (button:GetID() ~= button.currentID) then
		BibSetButtonID(button, button.currentID);
	end
	
	--Signal the action bars to be redrawn to make room for the button
	RedrawBibActionBar(button:GetParent():GetName());
end

--Get rid of any highlighting, flashing state, etc, from the button
--and Hide/Show and redraw it appropriately
function BibRedrawButton(button)
	--Get rid of any highlighting, flashing state, etc, from the current button ID
	--and get it ready to be updated for the new ID
	button:SetChecked(false);
	local cover = getglobal(button:GetName().."Cover");
	cover:SetVertexColor(0.0, 0.0, 0.0, 0.0);
	button.flashing = 0;
	getglobal(button:GetName().."Flash"):Hide();
	button.rangeTimer = -1;
		
	if(HasAction(button:GetID())) then
		showOccupiedButton(button);
	else
		showEmptyButton(button);
	end
end

function ShouldDisplayBackupID(button)
	return button.backupID ~= nil and HasAction(button.backupID) and not IDisReady(button.currentID);
end

function IDisReady(id)
	if(not HasAction(id)) then
		return true;
	end
	
	isUsable, notEnoughMana = IsUsableAction(id);
	if(notEnoughMana or not isUsable) then
		return false;
	end
	
	if(IsActionInRange(id) == 0) then
		return false;
	end
	
	local start, duration, enable = GetActionCooldown(id);
	if(start > 0 and duration ~= 1) then
		return false;
	end
	
	return true;
end

function PopupBibButtonIdMenu()
	BibActionButtonIdMenu.source = this;
	
	BibNormalIdEditBox:SetText(this.normalID);
	BibPage2IdEditBox:SetText(FormatIDForDisplay(this.page2ID));
	BibPage3IdEditBox:SetText(FormatIDForDisplay(this.page3ID));
	BibPage4IdEditBox:SetText(FormatIDForDisplay(this.page4ID));
	BibPage5IdEditBox:SetText(FormatIDForDisplay(this.page5ID));
	BibPage6IdEditBox:SetText(FormatIDForDisplay(this.page6ID));
	BibComboPoint1IdEditBox:SetText(FormatIDForDisplay(this.combopoint1ID));
	BibComboPoint2IdEditBox:SetText(FormatIDForDisplay(this.combopoint2ID));
	BibComboPoint3IdEditBox:SetText(FormatIDForDisplay(this.combopoint3ID));
	BibComboPoint4IdEditBox:SetText(FormatIDForDisplay(this.combopoint4ID));
	BibComboPoint5IdEditBox:SetText(FormatIDForDisplay(this.combopoint5ID));
	BibCombatIdEditBox:SetText(FormatIDForDisplay(this.combatID));
	BibShapeshift1IdEditBox:SetText(FormatIDForDisplay(this.shapeshift1ID));
	BibShapeshift2IdEditBox:SetText(FormatIDForDisplay(this.shapeshift2ID));
	BibShapeshift3IdEditBox:SetText(FormatIDForDisplay(this.shapeshift3ID));
	BibBackupIdEditBox:SetText(FormatIDForDisplay(this.backupID));
	
	BibShowPopupFrameAtCursor(BibActionButtonIdMenu);
	BibNormalIdEditBox:SetFocus();
	BibNormalIdEditBox:HighlightText();
end

function ApplyBibButtonIdMenu()
	local normalID = BibNormalIdEditBox:GetNumber();
	local page2ID = BibPage2IdEditBox:GetNumber();
	local page3ID = BibPage3IdEditBox:GetNumber();
	local page4ID = BibPage4IdEditBox:GetNumber();
	local page5ID = BibPage5IdEditBox:GetNumber();
	local page6ID = BibPage6IdEditBox:GetNumber();
	local combopoint1ID = BibComboPoint1IdEditBox:GetNumber();
	local combopoint2ID = BibComboPoint2IdEditBox:GetNumber();
	local combopoint3ID = BibComboPoint3IdEditBox:GetNumber();
	local combopoint4ID = BibComboPoint4IdEditBox:GetNumber();
	local combopoint5ID = BibComboPoint5IdEditBox:GetNumber();
	local combatID = BibCombatIdEditBox:GetNumber();
	local shapeshift1ID = BibShapeshift1IdEditBox:GetNumber();
	local shapeshift2ID = BibShapeshift2IdEditBox:GetNumber();
	local shapeshift3ID = BibShapeshift3IdEditBox:GetNumber();
	local backupID = BibBackupIdEditBox:GetNumber();
	
	if(normalID == nil) then
		message("The Normal ID of a button cannot be set to 0.");
		BibNormalIdEditBox:SetFocus();
		BibNormalIdEditBox:HighlightText();
		return;
	end	
	if(normalID > 120) then
		message("The Normal ID of a button cannot be greater than 120.");
		BibNormalIdEditBox:SetFocus();
		BibNormalIdEditBox:HighlightText();
		return;
	end
	if(page2ID > 120) then
		message("The Page 2 ID of a button cannot be greater than 120.");
		BibPage2IdEditBox:SetFocus();
		BibPage2IdEditBox:HighlightText();
		return;
	end
	if(page3ID > 120) then
		message("The Page 3 ID of a button cannot be greater than 120.");
		BibPage3IdEditBox:SetFocus();
		BibPage3IdEditBox:HighlightText();
		return;
	end
	if(page4ID > 120) then
		message("The Page 4 ID of a button cannot be greater than 120.");
		BibPage4IdEditBox:SetFocus();
		BibPage4IdEditBox:HighlightText();
		return;
	end
	if(page5ID > 120) then
		message("The Page 5 ID of a button cannot be greater than 120.");
		BibPage5IdEditBox:SetFocus();
		BibPage5IdEditBox:HighlightText();
		return;
	end
	if(page6ID > 120) then
		message("The Page 6 ID of a button cannot be greater than 120.");
		BibPage6IdEditBox:SetFocus();
		BibPage6IdEditBox:HighlightText();
		return;
	end
	if(combatID > 120) then
		message("The Combat ID of a button cannot be greater than 120.");
		BibCombatIdEditBox:SetFocus();
		BibCombatIdEditBox:HighlightText();
		return;
	end
	if(combatID > 120) then
		message("The Combat ID of a button cannot be greater than 120.");
		BibCombatIdEditBox:SetFocus();
		BibCombatIdEditBox:HighlightText();
		return;
	end
	if(combopoint1ID > 120) then
		message("The 1 Combo Point ID of a button cannot be greater than 120.");
		BibComboPoint1IdEditBox:SetFocus();
		BibComboPoint1IdEditBox:HighlightText();
		return;
	end
	if(combopoint2ID > 120) then
		message("The 2 Combo Points ID of a button cannot be greater than 120.");
		BibComboPoint2IdEditBox:SetFocus();
		BibComboPoint2IdEditBox:HighlightText();
		return;
	end
	if(combopoint3ID > 120) then
		message("The 3 Combo Points ID of a button cannot be greater than 120.");
		BibComboPoint3IdEditBox:SetFocus();
		BibComboPoint3IdEditBox:HighlightText();
		return;
	end
	if(combopoint4ID > 120) then
		message("The 4 Combo Points ID of a button cannot be greater than 120.");
		BibComboPoint4IdEditBox:SetFocus();
		BibComboPoint4IdEditBox:HighlightText();
		return;
	end
	if(combopoint5ID > 120) then
		message("The 5 Combo Points ID of a button cannot be greater than 120.");
		BibComboPoint5IdEditBox:SetFocus();
		BibComboPoint5IdEditBox:HighlightText();
		return;
	end
	if(shapeshift1ID > 120) then
		message("The Shapeshift 1 ID of a button cannot be greater than 120.");
		BibShapeshift1IdEditBox:SetFocus();
		BibShapeshift1IdEditBox:HighlightText();
		return;
	end
	if(shapeshift2ID > 120) then
		message("The Shapeshift 2 ID of a button cannot be greater than 120.");
		BibShapeshift2IdEditBox:SetFocus();
		BibShapeshift2IdEditBox:HighlightText();
		return;
	end
	if(shapeshift3ID > 120) then
		message("The Shapeshift 3 ID of a button cannot be greater than 120.");
		BibShapeshift3IdEditBox:SetFocus();
		BibShapeshift3IdEditBox:HighlightText();
		return;
	end
	if(backupID > 120) then
		message("The Backup ID of a button cannot be greater than 120.");
		BibBackupIdEditBox:SetFocus();
		BibBackupIdEditBox:HighlightText();
		return;
	end
	
	BibActionButtonIdMenu.source.normalID = ConvertDisplayIDForUse(normalID);
	BibActionButtonIdMenu.source.page2ID = ConvertDisplayIDForUse(page2ID);
	BibActionButtonIdMenu.source.page3ID = ConvertDisplayIDForUse(page3ID);
	BibActionButtonIdMenu.source.page4ID = ConvertDisplayIDForUse(page4ID);
	BibActionButtonIdMenu.source.page5ID = ConvertDisplayIDForUse(page5ID);
	BibActionButtonIdMenu.source.page6ID = ConvertDisplayIDForUse(page6ID);
	BibActionButtonIdMenu.source.combatID = ConvertDisplayIDForUse(combatID);
	BibActionButtonIdMenu.source.combopoint1ID = ConvertDisplayIDForUse(combopoint1ID);
	BibActionButtonIdMenu.source.combopoint2ID = ConvertDisplayIDForUse(combopoint2ID);
	BibActionButtonIdMenu.source.combopoint3ID = ConvertDisplayIDForUse(combopoint3ID);
	BibActionButtonIdMenu.source.combopoint4ID = ConvertDisplayIDForUse(combopoint4ID);
	BibActionButtonIdMenu.source.combopoint5ID = ConvertDisplayIDForUse(combopoint5ID);
	BibActionButtonIdMenu.source.shapeshift1ID = ConvertDisplayIDForUse(shapeshift1ID);
	BibActionButtonIdMenu.source.shapeshift2ID = ConvertDisplayIDForUse(shapeshift2ID);
	BibActionButtonIdMenu.source.shapeshift3ID = ConvertDisplayIDForUse(shapeshift3ID);
	BibActionButtonIdMenu.source.backupID = ConvertDisplayIDForUse(backupID);
	BibUpdateRegisteredEvents(BibActionButtonIdMenu.source);
	
	CopyButtonIDsToSaveRegisters(BibActionButtonIdMenu.source);
	UpdateBibButtonID(BibActionButtonIdMenu.source);
	BibActionButtonIdMenu:Hide();
end

function ConvertDisplayIDForUse(buttonID)
	if(buttonID == 0) then
		return nil;
	else
		return buttonID;
	end
end

function FormatIDForDisplay(buttonID)
	if(buttonID == nil) then
		return 0;
	else
		return buttonID;
	end
end

function CopyButtonIDsToSaveRegisters(button)
	SetHashedSaveValue("NormalIDs", button:GetName(), button.normalID);
	SetHashedSaveValue("Page2IDs", button:GetName(), button.page2ID);
	SetHashedSaveValue("Page3IDs", button:GetName(), button.page3ID);
	SetHashedSaveValue("Page4IDs", button:GetName(), button.page4ID);
	SetHashedSaveValue("Page5IDs", button:GetName(), button.page5ID);
	SetHashedSaveValue("Page6IDs", button:GetName(), button.page6ID);
	SetHashedSaveValue("ComboPoint1IDs", button:GetName(), button.combopoint1ID);
	SetHashedSaveValue("ComboPoint2IDs", button:GetName(), button.combopoint2ID);
	SetHashedSaveValue("ComboPoint3IDs", button:GetName(), button.combopoint3ID);
	SetHashedSaveValue("ComboPoint4IDs", button:GetName(), button.combopoint4ID);
	SetHashedSaveValue("ComboPoint5IDs", button:GetName(), button.combopoint5ID);
	SetHashedSaveValue("CombatIDs", button:GetName(), button.combatID);
	SetHashedSaveValue("Shapeshift1IDs", button:GetName(), button.shapeshift1ID);
	SetHashedSaveValue("Shapeshift2IDs", button:GetName(), button.shapeshift2ID);
	SetHashedSaveValue("Shapeshift3IDs", button:GetName(), button.shapeshift3ID);
	SetHashedSaveValue("BackupIDs", button:GetName(), button.backupID);
end

function CopySaveRegistersToButtonIDs(button)
	button.normalID = GetHashedSaveValue("NormalIDs", button:GetName());
	button.page2ID = GetHashedSaveValue("Page2IDs", button:GetName());
	button.page3ID = GetHashedSaveValue("Page3IDs", button:GetName());
	button.page4ID = GetHashedSaveValue("Page4IDs", button:GetName());
	button.page5ID = GetHashedSaveValue("Page5IDs", button:GetName());
	button.page6ID = GetHashedSaveValue("Page6IDs", button:GetName());
	button.combopoint1ID = GetHashedSaveValue("ComboPoint1IDs", button:GetName());
	button.combopoint2ID = GetHashedSaveValue("ComboPoint2IDs", button:GetName());
	button.combopoint3ID = GetHashedSaveValue("ComboPoint3IDs", button:GetName());
	button.combopoint4ID = GetHashedSaveValue("ComboPoint4IDs", button:GetName());
	button.combopoint5ID = GetHashedSaveValue("ComboPoint5IDs", button:GetName());
	button.combatID = GetHashedSaveValue("CombatIDs", button:GetName());
	button.shapeshift1ID = GetHashedSaveValue("Shapeshift1IDs", button:GetName());
	button.shapeshift2ID = GetHashedSaveValue("Shapeshift2IDs", button:GetName());
	button.shapeshift3ID = GetHashedSaveValue("Shapeshift3IDs", button:GetName());
	button.backupID = GetHashedSaveValue("BackupIDs", button:GetName());
	BibUpdateRegisteredEvents(button);
end

function SetBibButtonIDDefaults(button)
	local defaults = GetBibButtonIDDefaults(button);
	button.normalID = defaults.normalID;
	button.page2ID = defaults.page2ID;
	button.page3ID = defaults.page3ID;
	button.page4ID = defaults.page4ID;
	button.page5ID = defaults.page5ID;
	button.page6ID = defaults.page6ID;
	button.shapeshift1ID = defaults.shapeshift1ID;
	button.shapeshift2ID = defaults.shapeshift2ID;
	button.shapeshift3ID = defaults.shapeshift3ID;
	button.combatID = defaults.combatID;
	button.combopoint1ID = defaults.combopoint1ID;
	button.combopoint2ID = defaults.combopoint2ID;
	button.combopoint3ID = defaults.combopoint3ID;
	button.combopoint4ID = defaults.combopoint4ID;
	button.combopoint5ID = defaults.combopoint5ID;
	button.backupID = defaults.backupID;
end

function SetBibIDMenuToDefaults(button)
	local defaults = GetBibButtonIDDefaults(button);
	BibNormalIdEditBox:SetText(FormatIDForDisplay(defaults.normalID));
	BibPage2IdEditBox:SetText(FormatIDForDisplay(defaults.page2ID));
	BibPage3IdEditBox:SetText(FormatIDForDisplay(defaults.page3ID));
	BibPage4IdEditBox:SetText(FormatIDForDisplay(defaults.page4ID));
	BibPage5IdEditBox:SetText(FormatIDForDisplay(defaults.page5ID));
	BibPage6IdEditBox:SetText(FormatIDForDisplay(defaults.page6ID));
	BibShapeshift1IdEditBox:SetText(FormatIDForDisplay(defaults.shapeshift1ID));
	BibShapeshift2IdEditBox:SetText(FormatIDForDisplay(defaults.shapeshift2ID));
	BibShapeshift3IdEditBox:SetText(FormatIDForDisplay(defaults.shapeshift3ID));
	BibCombatIdEditBox:SetText(FormatIDForDisplay(defaults.combatID));
	BibComboPoint1IdEditBox:SetText(FormatIDForDisplay(defaults.combopoint1ID));
	BibComboPoint2IdEditBox:SetText(FormatIDForDisplay(defaults.combopoint2ID));
	BibComboPoint3IdEditBox:SetText(FormatIDForDisplay(defaults.combopoint3ID));
	BibComboPoint4IdEditBox:SetText(FormatIDForDisplay(defaults.combopoint4ID));
	BibComboPoint5IdEditBox:SetText(FormatIDForDisplay(defaults.combopoint5ID));
	BibBackupIdEditBox:SetText(FormatIDForDisplay(defaults.backupID));
end

function ZeroizeBibIDMenu(button)
	BibNormalIdEditBox:SetText(button.originalID);
	BibPage2IdEditBox:SetText(0);
	BibPage3IdEditBox:SetText(0);
	BibPage4IdEditBox:SetText(0);
	BibPage5IdEditBox:SetText(0);
	BibPage6IdEditBox:SetText(0);
	BibShapeshift1IdEditBox:SetText(0);
	BibShapeshift2IdEditBox:SetText(0);
	BibShapeshift3IdEditBox:SetText(0);
	BibCombatIdEditBox:SetText(0);
	BibComboPoint1IdEditBox:SetText(0);
	BibComboPoint2IdEditBox:SetText(0);
	BibComboPoint3IdEditBox:SetText(0);
	BibComboPoint4IdEditBox:SetText(0);
	BibComboPoint5IdEditBox:SetText(0);
	BibBackupIdEditBox:SetText(0);
end

function GetBibButtonIDDefaults(button)
	local defaults = {};
	defaults.normalID = button.originalID;
	if(12 >= button.originalID) then
		defaults.page2ID = button.originalID + 12;
		defaults.page3ID = button.originalID + 12 * 2;
		defaults.page4ID = button.originalID + 12 * 3;
		defaults.page5ID = button.originalID + 12 * 4;
		defaults.page6ID = button.originalID + 12 * 5;
		defaults.shapeshift1ID = button.originalID + 12 * 6;
		defaults.shapeshift2ID = button.originalID + 12 * 7;
		defaults.shapeshift3ID = button.originalID + 12 * 8;
	end
	return defaults;
end

function BibUpdateRegisteredEvents(button)
	button:UnregisterEvent("ACTIONBAR_PAGE_CHANGED");
	button:UnregisterEvent("PLAYER_ENTER_COMBAT");
	button:UnregisterEvent("PLAYER_LEAVE_COMBAT");
	button:UnregisterEvent("UPDATE_BONUS_ACTIONBAR");
	button:UnregisterEvent("PLAYER_COMBO_POINTS");
	
	if(button.page2ID ~= nil or
	   button.page3ID ~= nil or
	   button.page4ID ~= nil or
	   button.page5ID ~= nil or
	   button.page6ID ~= nil) then
		button:RegisterEvent("ACTIONBAR_PAGE_CHANGED");
	end
	
	if(button.shapeshift1ID ~= nil or
	   button.shapeshift2ID ~= nil or
	   button.shapeshift3ID ~= nil) then
		button:RegisterEvent("UPDATE_BONUS_ACTIONBAR");
	end
	
	if(button.combopoint1ID ~= nil or
	   button.combopoint2ID ~= nil or
	   button.combopoint3ID ~= nil or
	   button.combopoint4ID ~= nil or
	   button.combopoint5ID ~= nil) then
		button:RegisterEvent("PLAYER_COMBO_POINTS");
	end
	
	if(button.combatID ~= nil) then
		button:RegisterEvent("PLAYER_ENTER_COMBAT");
		button:RegisterEvent("PLAYER_LEAVE_COMBAT");
	end
end

function InitializeButtonIDs()
	SetHashedSaveValue("NormalIDs", this:GetName(), nil);
	SetHashedSaveValue("Page2IDs", this:GetName(), nil);
	SetHashedSaveValue("Page3IDs", this:GetName(), nil);
	SetHashedSaveValue("Page4IDs", this:GetName(), nil);
	SetHashedSaveValue("Page5IDs", this:GetName(), nil);
	SetHashedSaveValue("Page6IDs", this:GetName(), nil);
	SetHashedSaveValue("ComboPoint1IDs", this:GetName(), nil);
	SetHashedSaveValue("ComboPoint2IDs", this:GetName(), nil);
	SetHashedSaveValue("ComboPoint3IDs", this:GetName(), nil);
	SetHashedSaveValue("ComboPoint4IDs", this:GetName(), nil);
	SetHashedSaveValue("ComboPoint5IDs", this:GetName(), nil);
	SetHashedSaveValue("ComboPoint6IDs", this:GetName(), nil);
	SetHashedSaveValue("CombatIDs", this:GetName(), nil);
	SetHashedSaveValue("Shapeshift1IDs", this:GetName(), nil);
	SetHashedSaveValue("Shapeshift2IDs", this:GetName(), nil);
	SetHashedSaveValue("Shapeshift3IDs", this:GetName(), nil);
	SetHashedSaveValue("BackupIDs", this:GetName(), nil);
end